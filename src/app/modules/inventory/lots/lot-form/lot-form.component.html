<!-- lot-form.component.html -->
<form [formGroup]="form" (ngSubmit)="submit()" enctype="multipart/form-data"
  class="w-full min-h-screen p-6 space-y-6 bg-gray-50 dark:bg-slate-900 transition-colors">

  <!-- Row 1: Datos Generales + Finanzas -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Datos Generales -->
    <section class="form-section bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden transition-colors">
      <header
        class="px-5 py-3 bg-gray-100 dark:bg-slate-700 border-b border-gray-200 dark:border-slate-600 flex items-center gap-2">
        <span class="text-lg">📋</span>
        <h3 class="text-gray-800 dark:text-slate-200 font-semibold uppercase text-sm tracking-wide">
          {{ "inventory.lots.generalTitle" | translate }}
        </h3>
      </header>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 p-5">
        <!-- Manzana -->
        <div>
          <label class="block text-gray-600 dark:text-slate-400 mb-1">
            {{ "inventory.lots.manzana" | translate }}
          </label>
          <select formControlName="manzana_id"
            class="w-full bg-gray-50 dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg px-3 py-2 text-gray-800 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 transition">
            <option *ngFor="let m of manzanas" [value]="m.manzana_id" class="bg-white dark:bg-slate-800">
              {{ m.name }}
            </option>
          </select>
        </div>
        <!-- Tipo de Calle -->
        <div>
          <label class="block text-gray-600 dark:text-slate-400 mb-1">
            {{ "inventory.lots.streetType" | translate }}
          </label>
          <select formControlName="street_type_id"
            class="w-full bg-gray-50 dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg px-3 py-2 text-gray-800 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 transition">
            <option *ngFor="let s of streetTypes" [value]="s.street_type_id" class="bg-white dark:bg-slate-800">
              {{ s.name }}
            </option>
          </select>
        </div>
        <!-- Número de Lote -->
        <div class="sm:col-span-2">
          <label class="block text-gray-600 dark:text-slate-400 mb-1">
            {{ "inventory.lots.numLot" | translate }}
          </label>
          <input formControlName="num_lot"
            class="w-full bg-gray-50 dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg px-3 py-2 text-gray-800 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 transition" />
        </div>
      </div>
    </section>

    <!-- Finanzas -->
    <section class="form-section bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden transition-colors">
      <header
        class="px-5 py-3 bg-gray-100 dark:bg-slate-700 border-b border-gray-200 dark:border-slate-600 flex items-center gap-2">
        <span class="text-lg">💰</span>
        <h3 class="text-gray-800 dark:text-slate-200 font-semibold uppercase text-sm tracking-wide">
          {{ "inventory.lots.financesTitle" | translate }}
        </h3>
      </header>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 p-5">
        <!-- Precio Total -->
        <div>
          <label class="block text-gray-600 dark:text-slate-400 mb-1">
            {{ "inventory.lots.totalPrice" | translate }}
          </label>
          <div class="relative">
            <input type="number" formControlName="total_price"
              class="w-full bg-gray-50 dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg px-3 py-2 pr-14 text-gray-800 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 transition" />
            <span class="absolute inset-y-0 right-3 flex items-center text-gray-500 dark:text-slate-400">
              {{ form.get('currency')?.value || 'PEN' }}
            </span>
          </div>
        </div>
        <!-- Cuota Inicial -->
        <div>
          <label class="block text-gray-600 dark:text-slate-400 mb-1">
            {{ "inventory.lots.initialQuota" | translate }}
          </label>
          <input type="number" formControlName="initial_quota"
            class="w-full bg-gray-50 dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg px-3 py-2 text-gray-800 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 transition" />
        </div>
        <!-- Moneda -->
        <div class="sm:col-span-2">
          <label class="block text-gray-600 dark:text-slate-400 mb-1">
            {{ "inventory.lots.currency" | translate }}
          </label>
          <select formControlName="currency"
            class="w-full bg-gray-50 dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg px-3 py-2 text-gray-800 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 transition">
            <option class="bg-white dark:bg-slate-800" value="PEN">S/. PEN</option>
          </select>
        </div>
      </div>
    </section>
  </div>

  <!-- Row 2: Áreas + Subsidios -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Áreas -->
    <section class="form-section bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden transition-colors">
      <header
        class="px-5 py-3 bg-gray-100 dark:bg-slate-700 border-b border-gray-200 dark:border-slate-600 flex items-center gap-2">
        <span class="text-lg">📏</span>
        <h3 class="text-gray-800 dark:text-slate-200 font-semibold uppercase text-sm tracking-wide">
          {{ "inventory.lots.areasTitle" | translate }}
        </h3>
      </header>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 p-5">
        <!-- Área m² -->
        <div>
          <label class="block text-gray-600 dark:text-slate-400 mb-1">
            {{ "inventory.lots.areaM2" | translate }}
          </label>
          <div class="relative">
            <input type="number" formControlName="area_m2"
              class="w-full bg-gray-50 dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg px-3 py-2 pr-12 text-gray-800 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 transition" />
            <span class="absolute inset-y-0 right-3 flex items-center text-gray-500 dark:text-slate-400">
              m²
            </span>
          </div>
        </div>
        <!-- Área Construcción m² -->
        <div>
          <label class="block text-gray-600 dark:text-slate-400 mb-1">
            {{ "inventory.lots.areaConstructionM2" | translate }}
          </label>
          <div class="relative">
            <input type="number" formControlName="area_construction_m2"
              class="w-full bg-gray-50 dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg px-3 py-2 pr-12 text-gray-800 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 transition" />
            <span class="absolute inset-y-0 right-3 flex items-center text-gray-500 dark:text-slate-400">
              m²
            </span>
          </div>
        </div>
      </div>
    </section>

    <!-- Subsidios -->
    <section class="form-section bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden transition-colors">
      <header
        class="px-5 py-3 bg-gray-100 dark:bg-slate-700 border-b border-gray-200 dark:border-slate-600 flex items-center gap-2">
        <span class="text-lg">🏷️</span>
        <h3 class="text-gray-800 dark:text-slate-200 font-semibold uppercase text-sm tracking-wide">
          {{ "inventory.lots.subsidiesTitle" | translate }}
        </h3>
      </header>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 p-5">
        <div>
          <label class="block text-gray-600 dark:text-slate-400 mb-1">
            {{ "inventory.lots.funding" | translate }}
          </label>
          <input type="number" formControlName="funding"
            class="w-full bg-gray-50 dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg px-3 py-2 text-gray-800 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 transition" />
        </div>
        <div>
          <label class="block text-gray-600 dark:text-slate-400 mb-1">
            {{ "inventory.lots.BPP" | translate }}
          </label>
          <input type="number" formControlName="BPP"
            class="w-full bg-gray-50 dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg px-3 py-2 text-gray-800 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 transition" />
        </div>
        <div>
          <label class="block text-gray-600 dark:text-slate-400 mb-1">
            {{ "inventory.lots.BFH" | translate }}
          </label>
          <input type="number" formControlName="BFH"
            class="w-full bg-gray-50 dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg px-3 py-2 text-gray-800 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 transition" />
        </div>
      </div>
    </section>
  </div>

  <!-- Sección 5: Estado -->
  <section class="form-section bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden transition-colors">
    <header
      class="px-5 py-3 bg-gray-100 dark:bg-slate-700 border-b border-gray-200 dark:border-slate-600 flex items-center gap-2">
      <span class="text-lg">🔄</span>
      <h3 class="text-gray-800 dark:text-slate-200 font-semibold uppercase text-sm tracking-wide">
        {{ "inventory.lots.status.label" | translate }}
      </h3>
    </header>
    <div class="p-5">
      <select formControlName="status"
        class="w-full bg-gray-50 dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg px-3 py-2 text-gray-800 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 transition">
        <option class="bg-white dark:bg-slate-800" value="disponible">
          {{ "inventory.lots.status.disponible" | translate }}
        </option>
        <option class="bg-white dark:bg-slate-800" value="reservado">
          {{ "inventory.lots.status.reservado" | translate }}
        </option>
        <option class="bg-white dark:bg-slate-800" value="vendido">
          {{ "inventory.lots.status.vendido" | translate }}
        </option>
      </select>
    </div>
  </section>

  <!-- Sección 6: Multimedia -->
  <section class="form-section bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden transition-colors">
    <header
      class="px-5 py-3 bg-gray-100 dark:bg-slate-700 border-b border-gray-200 dark:border-slate-600 flex items-center gap-2">
      <span class="text-lg">🖼️</span>
      <h3 class="text-gray-800 dark:text-slate-200 font-semibold uppercase text-sm tracking-wide">
        {{ "inventory.lots.media" | translate }}
      </h3>
    </header>
    <div class="p-5 space-y-4">
      <!-- Upload zone -->
      <div class="relative">
        <input id="mediaInput" type="file" (change)="onMediaSelected($event)" multiple
          accept="image/*,application/pdf,video/*" class="hidden" />

        <label for="mediaInput" class="cursor-pointer block">
          <div
            class="upload-area bg-gray-50 dark:bg-slate-700 border-2 border-dashed border-gray-300 dark:border-slate-600 rounded-lg p-8 text-center"
            (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)"
            [class.border-indigo-500]="isDragOver" [class.bg-indigo-50]="isDragOver">
            <div class="text-3xl text-gray-400 dark:text-slate-400 mb-2">📁</div>
            <p class="text-gray-800 dark:text-slate-200 font-medium">Elegir archivos</p>
            <p class="text-gray-500 dark:text-slate-400 text-sm">o arrastra y suelta archivos aquí</p>
          </div>
        </label>
      </div>

      <!-- Selected files list -->
      <div *ngIf="selectedMedia.length; else noFiles" class="grid gap-3">
        <div *ngFor="let item of selectedMedia"
          class="file-item flex items-center justify-between bg-gray-50 dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg p-4 transition">
          <div class="flex items-center gap-2 overflow-hidden">
            <span class="text-xl text-gray-400 dark:text-slate-400">📄</span>
            <span class="text-gray-800 dark:text-slate-200 truncate">{{ item.file.name }}</span>
          </div>
          <select [(ngModel)]="item.type" [ngModelOptions]="{ standalone: true }"
            class="bg-gray-50 dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-lg px-3 py-2 text-gray-800 dark:text-slate-100 focus:ring-2 focus:ring-indigo-500 transition">
            <option value="foto">{{ "inventory.lots.media.type.foto" | translate }}</option>
            <option value="plano">{{ "inventory.lots.media.type.plano" | translate }}</option>
            <option value="video">{{ "inventory.lots.media.type.video" | translate }}</option>
            <option value="doc">{{ "inventory.lots.media.type.doc" | translate }}</option>
          </select>
        </div>
      </div>
      <ng-template #noFiles>
        <div class="text-center text-gray-500 dark:text-slate-400 py-8">
          <div class="text-4xl mb-2">📭</div>
          Sin archivos seleccionados
        </div>
      </ng-template>
    </div>
  </section>

  <!-- Botón guardar -->
  <div class="flex justify-end">
    <button type="submit"
      class="px-6 py-3 rounded-lg font-semibold shadow-lg transition bg-indigo-600 hover:bg-indigo-700 text-white">
      {{ isEditMode ? ("common.update" | translate) : ("common.create" | translate) }}
    </button>
  </div>
</form>