<div class="lot-detail-container" *ngIf="lot">
    <!-- Encabezado mejorado -->
    <div class="detail-header">
        <button (click)="back()" class="back-button">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                    d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
                    clip-rule="evenodd" />
            </svg>
            {{ 'common.back' | translate }}
        </button>

        <div class="title-container">
            <h1>{{ 'inventory.lots.detailTitle' | translate }}</h1>
            <div class="status-badge">
                <span class="dot"></span>
                {{ ('inventory.lots.status.' + lot.status) | translate }}
            </div>
            </div>
    </div>

    <!-- Grid principal -->
    <div class="detail-grid">
        <!-- Columna de datos -->
        <div class="data-column">
            <!-- Datos generales -->
            <div class="data-card">
                <h2 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="title-icon" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    {{ 'inventory.lots.generalTitle' | translate }}
                </h2>

                <div class="data-grid">
                    <div class="data-item">
                        <span class="data-label">{{ 'inventory.lots.manzana' | translate }}</span>
                        <span class="data-value">{{ lot.manzana?.name || '-' }}</span>
                    </div>

                    <div class="data-item">
                        <span class="data-label">{{ 'inventory.lots.streetType' | translate }}</span>
                        <span class="data-value">{{ lot.street_type?.name || '-' }}</span>
                    </div>

                    <div class="data-item">
                        <span class="data-label">{{ 'inventory.lots.numLot' | translate }}</span>
                        <span class="data-value">{{ lot.num_lot || '-' }}</span>
                    </div>

                    <div class="data-item">
                        <span class="data-label">{{ 'inventory.lots.areaM2' | translate }}</span>
                        <span class="data-value">{{ lot.area_m2 || '-' }} m²</span>
                    </div>

                    <div class="data-item">
                        <span class="data-label">{{ 'inventory.lots.areaConstructionM2' | translate }}</span>
                        <span class="data-value">{{ lot.area_construction_m2 || '-' }} m²</span>
                    </div>

                    <div class="data-item">
                        <span class="data-label">{{ 'inventory.lots.status.label' | translate }}</span>
                        <span class="data-value status-available">{{ lot.status || '-' }}</span>
                    </div>
                </div>
            </div>

            <!-- Finanzas -->
            <div class="data-card">
                <h2 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="title-icon" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    {{ 'inventory.lots.financesTitle' | translate }}
                </h2>

                <div class="data-grid">
                    <div class="data-item">
                        <span class="data-label">{{ 'inventory.lots.totalPrice' | translate }}</span>
                        <span class="data-value">{{ formatMoney(lot.total_price) }}</span>
                    </div>

                    <div class="data-item">
                        <span class="data-label">{{ 'inventory.lots.currency' | translate }}</span>
                        <span class="data-value">{{ lot.currency || '-' }}</span>
                    </div>

                    <div class="data-item">
                        <span class="data-label">Precio por m²</span>
                        <span class="data-value">{{ lot.external?.price_per_sqm ? formatMoney(lot.external?.price_per_sqm) : '-' }}</span>
                    </div>
                </div>
            </div>

            <div class="data-card">
                <h2 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="title-icon" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6 2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                    </svg>
                    Dimensiones
                </h2>

                <div class="data-grid">
                    <div class="data-item">
                        <span class="data-label">Frente</span>
                        <span class="data-value">{{ lot.external?.frontage ?? '-' }}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Fondo</span>
                        <span class="data-value">{{ lot.external?.depth ?? '-' }}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Orientación</span>
                        <span class="data-value">{{ lot.external?.orientation || '-' }}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Esquinero</span>
                        <span class="data-value">{{ yesNo(lot.external?.is_corner) }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Columna de detalles adicionales -->
        <div class="details-column">
            <div class="data-card" *ngIf="lot.financial_template">
                <h2 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="title-icon" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m10-8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2m-2-5a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    Financiamiento
                </h2>

                <div class="data-grid">
                    <div class="data-item">
                        <span class="data-label">Precio lista</span>
                        <span class="data-value">{{ formatMoney(lot.financial_template?.precio_lista) }}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Descuento</span>
                        <span class="data-value">{{ formatMoney(lot.financial_template?.descuento) }}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Precio venta</span>
                        <span class="data-value">{{ formatMoney(lot.financial_template?.precio_venta) }}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Precio contado</span>
                        <span class="data-value">{{ lot.financial_template?.precio_contado ? formatMoney(lot.financial_template?.precio_contado) : '-' }}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Cuota inicial</span>
                        <span class="data-value">{{ formatMoney(lot.financial_template?.cuota_inicial) }}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Cuota balón</span>
                        <span class="data-value">{{ lot.financial_template?.cuota_balon ? formatMoney(lot.financial_template?.cuota_balon) : '-' }}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Bono BPP</span>
                        <span class="data-value">{{ lot.financial_template?.bono_bpp ? formatMoney(lot.financial_template?.bono_bpp) : '-' }}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Cuotas disponibles</span>
                        <span class="data-value" *ngIf="getAvailableInstallments().length === 0">No configurado</span>
                        <div class="data-value" *ngIf="getAvailableInstallments().length > 0">
                            <div *ngFor="let i of getAvailableInstallments()">
                                {{ i.months }} meses: {{ formatMoney(i.amount) }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="data-card">
                <h2 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="title-icon" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Sincronización
                </h2>

                <div class="data-grid">
                    <div class="data-item">
                        <span class="data-label">Código externo</span>
                        <span class="data-value">{{ lot.external_code || '-' }}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">ID externo</span>
                        <span class="data-value">{{ lot.external_id || '-' }}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Fuente</span>
                        <span class="data-value">{{ lot.external?.source || '-' }}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Última sincronización</span>
                        <span class="data-value">{{ lot.external_sync_at || '-' }}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Observaciones</span>
                        <span class="data-value">{{ lot.external?.remarks || '-' }}</span>
                    </div>
                </div>
            </div>

            <!-- Multimedia -->
            <div class="data-card">
                <h2 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="title-icon" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    {{ 'inventory.lots.media' | translate }}
                </h2>

                <div class="media-grid">
                    <ng-container *ngFor="let m of lot.media">
                        <div class="media-item">
                            <div class="media-content">
                                <img *ngIf="m.type !== 'doc'" [src]="backendBaseUrl+m.url" class="media-image"
                                    alt="Media" />

                                <a *ngIf="m.type === 'doc'" [href]="backendBaseUrl+m.url" target="_blank" class="doc-link">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="doc-icon" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    <span>{{ getFileName(m.url) }}</span>
                                </a>
                            </div>
                            <div class="media-type">{{ m.type }}</div>
                        </div>
                    </ng-container>

                    <div *ngIf="!lot.media || lot.media.length === 0" class="no-media">
                        <svg xmlns="http://www.w3.org/2000/svg" class="no-media-icon" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        No hay elementos multimedia
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
